<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  <div class="head">
  
  <title>浏览器渲染原理</title>
  <meta name="author" content="hhlsdhh">
  <meta name="description" content="浏览器渲染机制一次网络请求的大致流程为（按照从上向下依次委派的逻辑来）：

网络应用程序（浏览器、邮件客户端…）调用操作系统中的各段程序(解析器、协议栈…)与服务器建立连接

并发送请求（协议栈与网卡进行配合，将数据分为网络包并转为电信号、光信号发出去）

接收数据并转换，最终渲染成用户可读的内容。">
  
  
  <meta property="og:title" content="浏览器渲染原理"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="小刘&#39;s blog"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="小刘&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="stylesheet" href="/css/head.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  </div>
<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <img class="back black-color" src="back.png">
  </img>
  
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        浏览器渲染原理
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2024-04-09T11:57:13.000Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2024-04-09
</time>


    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/categories/前端up向/">前端up向</a>





    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6"><span class="toc-text">浏览器渲染机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5URL%E5%9B%9E%E8%BD%A6%E4%B9%8B%E5%90%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E9%83%BD%E2%80%9D%E8%83%8C%E7%9D%80%E6%88%91%E4%BB%AC%E2%80%9D%E9%83%BD%E5%B9%B2%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">输入URL回车之后浏览器都”背着我们”都干了什么？</span></a></li></ol>
    
    <div class="picture-container">
      
    </div>
    <h4 id="浏览器渲染机制"><a href="#浏览器渲染机制" class="headerlink" title="浏览器渲染机制"></a>浏览器渲染机制</h4><p>一次网络请求的大致流程为（按照从上向下依次委派的逻辑来）：</p>
<ul>
<li><p>网络应用程序（浏览器、邮件客户端…）调用操作系统中的各段程序(解析器、协议栈…)与服务器建立连接</p>
</li>
<li><p>并发送请求（协议栈与网卡进行配合，将数据分为网络包并转为电信号、光信号发出去）</p>
</li>
<li><p>接收数据并转换，最终渲染成用户可读的内容。</p>
</li>
</ul>
<h4 id="输入URL回车之后浏览器都”背着我们”都干了什么？"><a href="#输入URL回车之后浏览器都”背着我们”都干了什么？" class="headerlink" title="输入URL回车之后浏览器都”背着我们”都干了什么？"></a>输入URL回车之后浏览器都”背着我们”都干了什么？</h4><p><strong>(1) 解析 URL：</strong> 先分析传输协议和请求资源路径。检查 URL 中的<code>协议</code>和<code>主机名</code>是否合法 ?</p>
<p><strong>(2) 缓存判断：</strong> 浏览器会根据该资源所采取的缓存策略进行缓存判断是直接拿缓存来用还是重新请求数据更新缓存。</p>
<p><strong>(3) DNS解析（域名解析，即域名 ——&gt; IP地址）：</strong></p>
<p>会先检查本地 DNS 服务器是否存在缓存，如果没有就会先向根域名服务器发起请求，获得负责的顶级域名服务器的地址后，再向顶级域名服务器请求，然后获得负责的权威域名服务器的地址后，再向权威域名服务器发起请求，最终获得域名的 IP 地址后，本地 DNS 服务器再将这个 IP 地址返回给操作系统。（整个过程由操作系统代浏览器进行）</p>
<p><strong>(4)获取 MAC 地址</strong>（当浏览器得到 IP 地址后，数据传输还需要知道目的主机 MAC 地址）：</p>
<p>-应用层 —-&gt; 传输层 ，TCP 指定源端口号、目的端口号。</p>
<p>-传输层 —–&gt; 网络层，网络层把获取的 IP 地址作为目的地址。</p>
<p>-网络层 —–&gt; 数据链路层，数据链路层把本机的 MAC 地址作为源 MAC 地址，目的 MAC 地址需要分情况处理：</p>
<ul>
<li>通过将 IP 地址与本机的子网掩码相与，可以判断是否与请求主机在同一个子网里？</li>
<li>如果在同一个子网里，可以使用 <strong>APR 协议</strong> 获取到目的主机的 MAC 地址</li>
<li>如果不在一个子网里，那么请求应该转发给网关，由它代为转发，此时同样可以通过 ARP 协议来获取网关的 MAC 地址，此时目的主机的 MAC 地址应该为网关的地址。</li>
</ul>
<p><strong>(5) TCP 三次握手建立连接：</strong></p>
<ul>
<li>客户端向服务器发送一个 SYN = 1，连接请求报文段和一个随机序号</li>
<li>服务端接收到请求后向服务器端发送一个 SYN=1 ，ACK=1 报文段，确认连接请求</li>
<li>客户端接收服务器的确认应答后，进入连接建立的状态，同时向服务器也发个ACK = 1 确认报文段</li>
</ul>
<p><strong>(6) HTTPS 下的 TLS 四次握手：</strong></p>
<ul>
<li>客户端向服务器端发送使用的协议的版本号、一个随机数和可以使用的加密方法</li>
<li>服务器端收到后，确认加密的方法，也向客户端发送一个随机数和自己的数书CA</li>
<li>客户端收到后，首先检查数字证书是否有效，如果有效，则再生成一个随机并<strong>使用证书中的公钥对随机数加密，然后发送给服务器端</strong></li>
<li>服务器端接收后，使用自己的私钥对数据解密，同时向客户端发送一个前面内容的 hash 值供客户端检验</li>
</ul>
<p>（这个时候双方都有了三个随机数，按照之前所约定的加密方法，使用这三个随机数生成一把秘钥，以后双方通信前，就使用这个秘钥对数据进行加密后再传输。）</p>
<p><strong>(7) 客户端发起请求，服务器响应</strong></p>
<p><strong>(8) 客户端收到数据，进行浏览器渲染：</strong></p>
<ul>
<li>解析 HTML，并生成 DOM 树</li>
<li>在解析 HTML 过程中，加载外部资源（CSS、js 、图片…）</li>
<li>解析 CSS ，构建 CSSOM 树</li>
<li>将 DOM 树和 CSSOM 树结合构建渲染树（渲染树只包含需要显示的元素和对应的样式信息。）</li>
<li>布局计算，浏览器根据渲染树中每个元素的尺寸、位置和样式信息进局计算，确定每个元素在页面中的准确位置。</li>
<li>绘制页面，浏览器使用布局计算得到的位置信息，将渲染树中的每个元素绘制到屏幕上，形成用户可见的网页。</li>
</ul>
<p><strong>(9) TCP四次挥手终端连接：</strong></p>
<ul>
<li>客户端认为数据发送完成，则它需要向服务端发送连接释放请求。</li>
<li>服务端收到连接释放请求后，会告诉应用层要释放 TCP 链接。然后会发送 AC包，并进入 CLOSE_WAI状态，此时表明客户端到服务端的连接已经释放，不再接收客户端发的数据了（客户端 — &gt; 服务器端已经断了）</li>
</ul>
<p>【但是因为 TCP 连接是双向的，所以服务端仍旧可以发送数据给客户端。服务端如果此时还有没发完的数据会继续发送】</p>
<ul>
<li>服务器端确定没有数据要发给客户端的了，发送连接释放请求，然后服务端入 LAST-ACK 状态。</li>
<li>客户端收到释放请求后，向服务端发送确认应答，此时客户端进入 TIME-WAI状态</li>
</ul>
<p>【该状态会持续 2MSL（最大段生存期，指报文段在网络中生存的时间，超时会被抛弃） 时间，若该时间段内没有服务端的重发请求的话，就进入 CLOSED 状态。当服务端收到确认应答后，也便进入 CLOSED 状态。】</p>


  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    页阅读量:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    站访问量:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    站访客数:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    






<script type="text/javascript">
$(".back").click(function(event) {
  window.history.back()
});
</script>
    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        © hhsdhh begin at 2022
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="https://github.com/gaoryrt/hexo-theme-pln">
        moments
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
